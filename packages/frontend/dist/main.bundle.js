(()=>{"use strict";var e={},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.rv=function(){return"1.0.14"},r.ruid="bundler=rspack@1.0.14";let n=(e,t)=>e===t,s=function(e,t){if("function"==typeof e)return function(){return e(arguments)?t.apply(this,arguments):e=>t(e,...arguments)};switch(e){case 0:case 1:throw RangeError(`Invalid arity ${e}`);case 2:return function(e,r){return arguments.length>=2?t(e,r):function(r){return t(r,e)}};case 3:return function(e,r,n){return arguments.length>=3?t(e,r,n):function(n){return t(n,e,r)}};case 4:return function(e,r,n,s){return arguments.length>=4?t(e,r,n,s):function(s){return t(s,e,r,n)}};case 5:return function(e,r,n,s,i){return arguments.length>=5?t(e,r,n,s,i):function(i){return t(i,e,r,n,s)}};default:return function(){if(arguments.length>=e)return t.apply(this,arguments);let r=arguments;return function(e){return t(e,...r)}}}},i=e=>e,a=Symbol.for("effect/GlobalValue/globalStoreId/3.10.3");!(a in globalThis)&&(globalThis[a]=new Map);let o=globalThis[a],l=(e,t)=>(!o.has(e)&&o.set(e,t()),o.get(e)),u=e=>"string"==typeof e,c=e=>"number"==typeof e,f=e=>"boolean"==typeof e,h=e=>"function"==typeof e,d=e=>"object"==typeof e&&null!==e,g=e=>d(e)||h(e),p=s(2,(e,t)=>g(e)&&t in e),y=s(2,(e,t)=>p(e,"_tag")&&e._tag===t),b=e=>d(e)&&!Array.isArray(e),m=e=>`BUG: ${e} - please report an issue at https://github.com/Effect-TS/effect/issues`,_=Symbol.for("effect/Gen/GenKind");Symbol.iterator;class S{self;called=!1;constructor(e){this.self=e}next(e){return this.called?{value:e,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(e){return{value:e,done:!0}}throw(e){throw e}[Symbol.iterator](){return new S(this.self)}}let O=Symbol.for("effect/Utils/YieldWrap");class E{#e;constructor(e){this.#e=e}[O](){return this.#e}}let v=l("effect/Utils/isStructuralRegion",()=>({enabled:!1,tester:void 0})),w=l(Symbol.for("effect/Hash/randomHashCache"),()=>new WeakMap),k=Symbol.for("effect/Hash"),R=e=>{if(!0===v.enabled)return 0;switch(typeof e){case"number":return M(e);case"bigint":return N(e.toString(10));case"boolean":case"symbol":return N(String(e));case"string":return N(e);case"undefined":return N("undefined");case"function":case"object":if(null===e)return N("null");if(e instanceof Date)return R(e.toISOString());else if(I(e))return e[k]();else return j(e);default:throw Error(`BUG: unhandled typeof ${typeof e} - please report an issue at https://github.com/Effect-TS/effect/issues`)}},j=e=>(!w.has(e)&&w.set(e,M(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))),w.get(e)),L=e=>t=>53*t^e,T=e=>0xbfffffff&e|e>>>1&0x40000000,I=e=>p(e,k),M=e=>{if(e!=e||e===1/0)return 0;let t=0|e;for(t!==e&&(t^=0xffffffff*e);e>0xffffffff;)t^=e/=0xffffffff;return T(t)},N=e=>{let t=5381,r=e.length;for(;r;)t=33*t^e.charCodeAt(--r);return T(t)},x=(e,t)=>{let r=12289;for(let n=0;n<t.length;n++)r^=function(e,t,r,n,s,i,a,o,l){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return r(t(e));case 4:return n(r(t(e)));case 5:return s(n(r(t(e))));case 6:return i(s(n(r(t(e)))));case 7:return a(i(s(n(r(t(e))))));case 8:return o(a(i(s(n(r(t(e)))))));case 9:return l(o(a(i(s(n(r(t(e))))))));default:{let e=arguments[0];for(let t=1;t<arguments.length;t++)e=arguments[t](e);return e}}}(N(t[n]),L(R(e[t[n]])));return T(r)},A=e=>x(e,Object.keys(e)),U=function(){if(1==arguments.length){let e=arguments[0];return function(t){return Object.defineProperty(e,k,{value:()=>t,enumerable:!1}),t}}let e=arguments[0],t=arguments[1];return Object.defineProperty(e,k,{value:()=>t,enumerable:!1}),t},$=Symbol.for("effect/Equal");function D(){return 1==arguments.length?e=>C(e,arguments[0]):C(arguments[0],arguments[1])}function C(e,t){if(e===t)return!0;let r=typeof e;if(r!==typeof t)return!1;if("object"===r||"function"===r){if(null!==e&&null!==t){if(F(e)&&F(t))return!!(R(e)===R(t)&&e[$](t))||!!v.enabled&&!!v.tester&&v.tester(e,t);if(e instanceof Date&&t instanceof Date)return e.toISOString()===t.toISOString()}if(v.enabled){if(Array.isArray(e)&&Array.isArray(t))return e.length===t.length&&e.every((e,r)=>C(e,t[r]));if(Object.getPrototypeOf(e)===Object.prototype&&Object.getPrototypeOf(e)===Object.prototype){let r=Object.keys(e),n=Object.keys(t);if(r.length===n.length){for(let n of r)if(!(n in t&&C(e[n],t[n])))return!!v.tester&&v.tester(e,t);return!0}}return!!v.tester&&v.tester(e,t)}}return!!v.enabled&&!!v.tester&&v.tester(e,t)}let F=e=>p(e,$),J=Symbol.for("nodejs.util.inspect.custom"),P=e=>p(e,"toJSON")&&h(e.toJSON)&&0===e.toJSON.length?e.toJSON():Array.isArray(e)?e.map(P):Y(e),z=e=>JSON.stringify(e,null,2),H=(e,t=2)=>{if("string"==typeof e)return e;try{return"object"==typeof e?G(e,t):String(e)}catch(t){return String(e)}},G=(e,t)=>{let r=[],n=JSON.stringify(e,(e,t)=>"object"==typeof t&&null!==t?r.includes(t)?void 0:r.push(t)&&(void 0!==V.fiberRefs&&B(t)?t[q](V.fiberRefs):t):t,t);return r=void 0,n},q=Symbol.for("effect/Inspectable/Redactable"),B=e=>"object"==typeof e&&null!==e&&q in e,V=l("effect/Inspectable/redactableState",()=>({fiberRefs:void 0})),Y=e=>B(e)&&void 0!==V.fiberRefs?e[q](V.fiberRefs):e,X=(e,t)=>{switch(t.length){case 0:return e;case 1:return t[0](e);case 2:return t[1](t[0](e));case 3:return t[2](t[1](t[0](e)));case 4:return t[3](t[2](t[1](t[0](e))));case 5:return t[4](t[3](t[2](t[1](t[0](e)))));case 6:return t[5](t[4](t[3](t[2](t[1](t[0](e))))));case 7:return t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))));case 8:return t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e))))))));case 9:return t[8](t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))))));default:{let r=e;for(let e=0,n=t.length;e<n;e++)r=t[e](r);return r}}},W=Symbol.for("effect/Effect"),K=Symbol.for("effect/Stream"),Q=Symbol.for("effect/Sink"),Z=Symbol.for("effect/Channel"),ee={_R:e=>e,_E:e=>e,_A:e=>e,_V:"3.10.3"},et={[W]:ee,[K]:ee,[Q]:{_A:e=>e,_In:e=>e,_L:e=>e,_E:e=>e,_R:e=>e},[Z]:{_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},[$](e){return this===e},[k](){return U(this,j(this))},[Symbol.iterator](){return new S(new E(this))},pipe(){return X(this,arguments)}},er={[k](){return U(this,A(this))},[$](e){let t=Object.keys(this),r=Object.keys(e);if(t.length!==r.length)return!1;for(let r of t)if(!(r in e&&D(this[r],e[r])))return!1;return!0}},en={...et,_op:"Commit"},es=Symbol.for("effect/Option"),ei={...et,[es]:{_A:e=>e},[J](){return this.toJSON()},toString(){return z(this.toJSON())}},ea=Object.assign(Object.create(ei),{_tag:"Some",_op:"Some",[$](e){return eu(e)&&ef(e)&&D(this.value,e.value)},[k](){return U(this,L(R(this._tag))(R(this.value)))},toJSON(){return{_id:"Option",_tag:this._tag,value:P(this.value)}}}),eo=R("None"),el=Object.assign(Object.create(ei),{_tag:"None",_op:"None",[$]:e=>eu(e)&&ec(e),[k]:()=>eo,toJSON(){return{_id:"Option",_tag:this._tag}}}),eu=e=>p(e,es),ec=e=>"None"===e._tag,ef=e=>"Some"===e._tag,eh=Object.create(el),ed=e=>{let t=Object.create(ea);return t.value=e,t},eg=Symbol.for("effect/Either"),ep={...et,[eg]:{_R:e=>e},[J](){return this.toJSON()},toString(){return z(this.toJSON())}},ey=Object.assign(Object.create(ep),{_tag:"Right",_op:"Right",[$](e){return em(e)&&eS(e)&&D(this.right,e.right)},[k](){return L(R(this._tag))(R(this.right))},toJSON(){return{_id:"Either",_tag:this._tag,right:P(this.right)}}}),eb=Object.assign(Object.create(ep),{_tag:"Left",_op:"Left",[$](e){return em(e)&&e_(e)&&D(this.left,e.left)},[k](){return L(R(this._tag))(R(this.left))},toJSON(){return{_id:"Either",_tag:this._tag,left:P(this.left)}}}),em=e=>p(e,eg),e_=e=>"Left"===e._tag,eS=e=>"Right"===e._tag,eO=e=>{let t=Object.create(eb);return t.left=e,t},eE=e=>{let t=Object.create(ey);return t.right=e,t},ev=()=>eh;Symbol.iterator,()=>ew;let ew={next:()=>({done:!0,value:void 0})},ek=e=>(t,r)=>t===r?0:e(t,r);(e,t)=>e<t?-1:1;Object.fromEntries,(e,t)=>{let r=[];for(let n of eR(e))r.push(t(n,e[n]));return r};let eR=e=>Object.keys(e),ej=e=>Array.isArray(e)?e:Array.from(e),eL=e=>Array.isArray(e)?e:[e],eT=e=>dual(2,(t,r)=>{for(let n of t)if(e(r,n))return!0;return!1}),eI=()=>[],eM=Symbol.for("effect/Context/Tag"),eN=Symbol.for("effect/STM"),ex={...et,_op:"Tag",[eN]:ee,[eM]:{_Service:e=>e,_Identifier:e=>e},toString(){return z(this.toJSON())},toJSON(){return{_id:"Tag",key:this.key,stack:this.stack}},[J](){return this.toJSON()},of:e=>e,context(e){return eJ(this,e)}},eA=Symbol.for("effect/Context"),eU={[eA]:{_Services:e=>e},[$](e){if(eC(e)&&this.unsafeMap.size===e.unsafeMap.size){for(let t of this.unsafeMap.keys())if(!e.unsafeMap.has(t)||!D(this.unsafeMap.get(t),e.unsafeMap.get(t)))return!1;return!0}return!1},[k](){return U(this,M(this.unsafeMap.size))},pipe(){return X(this,arguments)},toString(){return z(this.toJSON())},toJSON(){return{_id:"Context",services:Array.from(this.unsafeMap).map(P)}},[J](){return this.toJSON()}},e$=e=>{let t=Object.create(eU);return t.unsafeMap=e,t},eD=e=>{let t=Error(`Service not found${e.key?`: ${String(e.key)}`:""}`);if(e.stack){let r=e.stack.split("\n");if(r.length>2){let e=r[2].match(/at (.*)/);e&&(t.message=t.message+` (defined at ${e[1]})`)}}if(t.stack){let e=t.stack.split("\n");e.splice(1,3),t.stack=e.join("\n")}return t},eC=e=>p(e,eA),eF=e$(new Map),eJ=(e,t)=>e$(new Map([[e.key,t]])),eP=s(3,(e,t,r)=>{let n=new Map(e.unsafeMap);return n.set(t.key,r),e$(n)}),ez=s(2,(e,t)=>{if(!e.unsafeMap.has(t.key))throw eD(t);return e.unsafeMap.get(t.key)}),eH=()=>eF,eG=e=>()=>{let t=Error.stackTraceLimit;Error.stackTraceLimit=2;let r=Error();function n(){}return Error.stackTraceLimit=t,Object.setPrototypeOf(n,ex),n.key=e,Object.defineProperty(n,"stack",{get:()=>r.stack}),n};class eq{self;called=!1;constructor(e){this.self=e}next(e){return this.called?{value:e,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(e){return{value:e,done:!0}}throw(e){throw e}[Symbol.iterator](){return new eq(this.self)}}let eB=Symbol.for("effect/Micro"),eV=Symbol.for("effect/Micro/runSymbol"),eY=e=>"object"==typeof e&&null!==e&&eB in e,eX={...et,_op:"Micro",[eB]:{_A:i,_E:i,_R:i},[Symbol.iterator](){return new eq(new E(this))}},eW=function(){function e(){}return e.prototype=eX,e}();class eK extends eW{[eV](e,t){this.asMicro()[eV](e,t)}}let eQ=Symbol.for("effect/Micro/MicroCause"),eZ={_E:i};class e0 extends globalThis.Error{_tag;traces;[eQ];constructor(e,t,r){let n,s,i;let a=`MicroCause.${e}`;if(t instanceof globalThis.Error){n=`(${a}) ${t.name}`;let e=(s=t.message).split("\n").length;i=t.stack?`(${a}) ${t.stack.split("\n").slice(0,e+3).join("\n")}`:`${n}: ${s}`}else n=a,s=H(t,0),i=`${n}: ${s}`;r.length>0&&(i+=`
    ${r.join("\n    ")}`),super(s),this._tag=e,this.traces=r,this[eQ]=eZ,this.name=n,this.stack=i}pipe(){return X(this,arguments)}toString(){return this.stack}[J](){return this.stack}}class e1 extends e0{error;constructor(e,t=[]){super("Fail",e,t),this.error=e}}let e2=(e,t=[])=>new e1(e,t);class e3 extends e0{defect;constructor(e,t=[]){super("Die",e,t),this.defect=e}}let e4=(e,t=[])=>new e3(e,t);class e5 extends e0{constructor(e=[]){super("Interrupt","interrupted",e)}}let e8=(e=[])=>new e5(e),e6=e=>"Fail"===e._tag,e7=e=>"Fail"===e._tag?e.error:"Die"===e._tag?e.defect:e,e9=s(2,(e,t)=>{let r=[...e.traces,t];switch(e._tag){case"Die":return e4(e.defect,r);case"Interrupt":return e8(r);case"Fail":return e2(e.error,r)}}),te=eO(e8()),tt=e=>eO(e2(e)),tr=e=>eO(e4(e)),tn={[Symbol.for("effect/Micro/Env")]:{_R:i},pipe(){return X(this,arguments)}},ts=e=>{let t=Object.create(tn);return t.refs=e,t},ti=s(2,(e,t)=>t.key in e.refs?e.refs[t.key]:t.initial),ta=s(3,(e,t,r)=>{let n=Object.assign(Object.create(null),e.refs);return n[t.key]=r,ts(n)}),to=s(2,(e,t)=>ts(t(Object.assign(Object.create(null),e.refs)))),tl=e=>tR(function(t,r){r(eE(ez(ti(t,tm),e)))}),tu=e=>tR((t,r)=>r(eE(ti(t,e)))),tc=s(3,(e,t,r)=>tR(function(n,s){let i=ti(n,tm),a=ta(n,tm,eP(i,t,r));e[eV](a,s)})),tf="setImmediate"in globalThis?globalThis.setImmediate:e=>setTimeout(e,0);class th{tasks=[];running=!1;scheduleTask(e,t){this.tasks.push(e),!this.running&&(this.running=!0,tf(this.afterScheduled))}afterScheduled=()=>{this.running=!1,this.runTasks()};runTasks(){let e=this.tasks;this.tasks=[];for(let t=0,r=e.length;t<r;t++)e[t]()}shouldYield(e){return!1}flush(){for(;this.tasks.length>0;)this.runTasks()}}let td=Symbol.for("effect/Micro/EnvRef"),tg={...eX,[td]:td,[eV](e,t){tu(this)[eV](e,t)}},tp=(e,t)=>l(e,()=>{let r=Object.create(tg);return r.key=e,r.initial=t(),r}),ty=tp("effect/Micro/currentAbortController",()=>void 0),tb=tp("effect/Micro/currentAbortSignal",()=>void 0),tm=tp("effect/Micro/currentContext",()=>eH()),t_=tp("effect/Micro/currentConcurrency",()=>"unbounded"),tS=tp("effect/Micro/currentMaxDepthBeforeYield",()=>2048),tO=tp("effect/Micro/currentInterruptible",()=>!0),tE=tp("effect/Micro/currentScheduler",()=>new th),tv=l("effect/Micro/microDepthState",()=>({depth:0,maxDepthBeforeYield:tS.initial})),tw=e=>{let t=Object.create(eX);return t[eV]=e,t},tk=(e,t)=>tw(function r(n,s){if(t&&!1!==n.refs[tO.key]&&n.refs[tb.key].aborted)return s(te);tv.depth++,1===tv.depth&&(tv.maxDepthBeforeYield=ti(n,tS));let i=n.refs[tE.key];if(tv.depth>=tv.maxDepthBeforeYield||i.shouldYield(n))i.scheduleTask(()=>r(n,s),0);else try{e(n,s)}catch(e){s(tr(e))}tv.depth--}),tR=e=>tk(e,!0),tj=e=>tR(function(t,r){r(e)}),tL=e=>tj(eE(e)),tT=e=>tj(tt(e)),tI=e=>tj(tr(e)),tM=e=>tj(eO(e)),tN=e=>tR(function(t,r){r(eE(e()))}),tx=e=>tR(function(t,r){e()[eV](t,r)}),tA=e=>tR(function(t,r){let n,s=!1,i=e.length>1?new AbortController:void 0,a=ti(t,tb);function o(){n?l(t1(tP(n,tj(te)))):l(tj(te)),void 0!==i&&i.abort()}function l(e){if(!s)s=!0,a.removeEventListener("abort",o),e[eV](t,r)}n=void 0===i?e(l):e(l,i.signal),!s&&a.addEventListener("abort",o)}),tU=e=>tR(function(t,r){try{r(eE(e.try()))}catch(t){r(tt(e.catch(t)))}}),t$=e=>tA(function(t,r){e(r).then(e=>t(tL(e)),e=>t(tI(e)))}),tD=e=>tA(function(t,r){try{e.try(r).then(e=>t(tL(e)),r=>t(tT(e.catch(r))))}catch(r){t(tT(e.catch(r)))}}),tC=(...e)=>tR(function(t,r){let n,s=1===e.length?e[0]():e[1].call(e[0]),i=!1;!function e(){i=!0;try{let a=!0;for(;a;){let o=s.next(n);if(o.done)return r(eE(o.value));a=!1,(function(e){if("object"==typeof e&&null!==e&&O in e)return e[O]();throw Error(m("yieldWrapGet"))})(o.value)[eV](t,function(t){"Left"===t._tag?r(t):(a=!0,n=t.right,!i&&e())})}}catch(e){r(tr(e))}i=!1}()}),tF=s(2,(e,t)=>tR(function(r,n){e[eV](r,function(e){n("Left"===e._tag?e:eE(t(e.right)))})})),tJ=s(2,(e,t)=>tR(function(r,n){e[eV](r,function(e){if("Left"===e._tag)return n(e);t(e.right)[eV](r,n)})})),tP=s(2,(e,t)=>tR(function(r,n){e[eV](r,function(e){if("Left"===e._tag)return n(e);if(ti(r,tb).aborted)return n(te);let s=eY(t)?t:"function"==typeof t?t(e.right):t;eY(s)?s[eV](r,n):n(eE(s))})})),tz=s(2,(e,t)=>tR(function(r,n){e[eV](r,function(e){if("Left"===e._tag)return n(e);if(ti(r,tb).aborted)return n(te);let s=eY(t)?t:"function"==typeof t?t(e.right):t;eY(s)?s[eV](r,function(t){if("Left"===t._tag)return n(t);n(e)}):n(e)})})),tH=e=>tF(e,e=>void 0),tG=e=>tR(function(t,r){e[eV](t,function(e){r(eE(e))})});function tq(e){let t=new AbortController,r=ti(e,tb);function n(){t.abort(),r.removeEventListener("abort",n)}return r.addEventListener("abort",n),[to(e,function(e){return e[ty.key]=t,e[tb.key]=t.signal,e}),n]}let tB=s(e=>eY(e[0]),(e,t,r)=>tJ(e,e=>t(e)?tL(e):tT(r(e)))),tV=s(3,(e,t,r)=>tR(function(n,s){e[eV](n,function(e){"Right"!==e._tag&&t(e.left)?r(e.left)[eV](n,s):s(e)})})),tY=s(3,(e,t,r)=>tV(e,t,e=>tP(r(e),tM(e)))),tX=s(2,(e,t)=>tY(e,e6,e=>t(e.error))),tW=s(3,(e,t,r)=>tV(e,e=>e6(e)&&t(e.error),e=>r(e.error))),tK=s(3,(e,t,r)=>tW(e,y(t),r)),tQ=function(){let e=globalThis.Error.stackTraceLimit;globalThis.Error.stackTraceLimit=2;let t=new globalThis.Error;globalThis.Error.stackTraceLimit=e;let r=e=>r=>tk(function(n,s){r[eV](n,function(r){s("Left"===r._tag?eO(function(e,r){let n=t.stack;if(!n)return r;let s=n.split("\n")[2]?.trim().replace(/^at /,"");if(!s)return r;let i=s.match(/\((.*)\)$/);return e9(r,`at ${e} (${i?i[1]:s})`)}(e,r.left)):r)})},!1);return 2==arguments.length?r(arguments[1])(arguments[0]):r(arguments[0])},tZ=Symbol.for("effect/Micro/MicroScope");class t0{[tZ];state={_tag:"Open",finalizers:new Set};constructor(){this[tZ]=tZ}unsafeAddFinalizer(e){"Open"===this.state._tag&&this.state.finalizers.add(e)}addFinalizer(e){return tx(()=>"Open"===this.state._tag?(this.state.finalizers.add(e),null):e(this.state.exit))}unsafeRemoveFinalizer(e){"Open"===this.state._tag&&this.state.finalizers.delete(e)}close(e){return tx(()=>{if("Open"===this.state._tag){let t=Array.from(this.state.finalizers).reverse();return this.state={_tag:"Closed",exit:e},tJ(t3(t,t=>tG(t(e))),e=>tH(tj(Either.all(e))))}return null})}get fork(){return tN(()=>{let e=new t0;if("Closed"===this.state._tag)return e.state=this.state,e;function t(t){return e.close(t)}return this.state.finalizers.add(t),e.unsafeAddFinalizer(e=>tN(()=>this.unsafeRemoveFinalizer(t))),e})}}let t1=e=>tk(function(t,r){let n=to(t,function(e){return e[tO.key]=!1,e[tb.key]=new AbortController().signal,e});e[eV](n,r)},!1),t2=e=>tR((t,r)=>{let n=ti(t,tO),s=t;if(!n){let e=ti(t,ty);s=to(t,function(t){return t[tO.key]=!0,t[tb.key]=e.signal,t})}e[eV](s,r)}),t3=(e,t,r)=>tR(function(n,s){let i,a=r?.concurrency==="inherit"?ti(n,t_):r?.concurrency??1,o="unbounded"===a?Number.POSITIVE_INFINITY:Math.max(1,a),[l,u]=tq(n);let c=Array.from(e),f=c.length;if(0===f)return s(eE(r?.discard?void 0:[]));let h=r?.discard?void 0:Array(f),d=0,g=0,p=0,y=!1;!function e(){for(y=!0;g<o&&d<f;){let r=d,n=c[r];d++,g++;try{t(n,r)[eV](l,function(t){"Left"===t._tag?void 0===i&&(i=t,f=d,u()):void 0!==h&&(h[r]=t.right),p++,g--,p===f?s(i??eE(h)):!y&&g<o&&e()})}catch(e){i=tr(e),f=d,u()}}y=!1}()}),t4=Symbol.for("effect/Micro/Handle");class t5 extends eK{parentSignal;[t4];observers=new Set;_exit=void 0;_controller;isRoot;constructor(e,t){super(),this.parentSignal=e,this[t4]=t4,this.isRoot=void 0!==t,this._controller=t??new AbortController,!this.isRoot&&e.addEventListener("abort",this.unsafeInterrupt)}unsafePoll(){return this._exit??null}unsafeInterrupt=()=>{this._controller.abort()};emit(e){if(!this._exit)this._exit=e,!this.isRoot&&this.parentSignal.removeEventListener("abort",this.unsafeInterrupt),this.observers.forEach(t=>t(e)),this.observers.clear()}addObserver(e){if(this._exit)return e(this._exit);this.observers.add(e)}removeObserver(e){this.observers.delete(e)}get await(){return tx(()=>this._exit?tL(this._exit):tA(e=>{function t(t){e(tL(t))}return this.addObserver(t),tN(()=>{this.removeObserver(t)})}))}get join(){return tJ(this.await,tj)}get interrupt(){return tx(()=>(this.unsafeInterrupt(),this.await))}asMicro(){return this.join}}let t8=(e,t)=>{let r=new AbortController,n=Object.create(null);n[ty.key]=r,n[tb.key]=r.signal,n[tE.key]=t?.scheduler??new th;let s=ts(n),i=new t5(r.signal,r);return e[eV](ta(s,tb,i._controller.signal),e=>{i.emit(e),t?.signal&&t.signal.removeEventListener("abort",i.unsafeInterrupt)}),t?.signal&&(t.signal.aborted?i.unsafeInterrupt():t.signal.addEventListener("abort",i.unsafeInterrupt,{once:!0})),i},t6=(e,t)=>new Promise((r,n)=>{t8(e,t).addObserver(r)}),t7=(e,t)=>t6(e,t).then(e=>{if("Left"===e._tag)throw e.left;return e.right}),t9=e=>{let t=new th,r=t8(e,{scheduler:t});t.flush();let n=r.unsafePoll();return null===n?tr(r):n},re=e=>{let t=t9(e);if("Left"===t._tag)throw t.left;return t.right},rt=function(){class e extends globalThis.Error{[eV](e,t){t(tt(this))}toString(){return this.message?`${this.name}: ${this.message}`:this.name}toJSON(){return{...this}}[J](){let e=this.stack;return e?`${this.toString()}
${e.split("\n").slice(1).join("\n")}`:this.toString()}}return Object.assign(e.prototype,eX,er),e}(),rr=class extends rt{constructor(e){super(),e&&Object.assign(this,e)}},rn=e=>{class t extends rr{_tag=e}return t.prototype.name=e,t};class rs extends rn("InvalidURL"){constructor(e){super({reason:`Failed to parse '${e}' as a URL.`})}}class ri extends rn("FetchError"){}class ra extends rn("InvalidJson"){}class ro extends rn("BadRequestError"){getMessage(){return b(this.json)&&"string"==typeof this.json.message?this.json.message:this.message}}class rl extends rn("UploadAborted"){}class ru extends rn("UploadAborted"){}let rc=e=>tC(function*(){let t="undefined"!=typeof window?window.location.origin:process.env?.VERCEL_URL?`https://${process.env.VERCEL_URL}`:"http://localhost:3000",r=yield*tU({try:()=>new URL(e??"/api/uploadthing",t),catch:()=>new rs(e??"/api/uploadthing")});return"/"===r.pathname&&(r.pathname="/api/uploadthing"),r}),rf=e=>e instanceof URL?e:re(rc(e));function rh(){}let rd={BAD_REQUEST:400,NOT_FOUND:404,FORBIDDEN:403,INTERNAL_SERVER_ERROR:500,INTERNAL_CLIENT_ERROR:500,TOO_LARGE:413,TOO_SMALL:400,TOO_MANY_FILES:400,KEY_TOO_LONG:400,URL_GENERATION_FAILED:500,UPLOAD_FAILED:500,MISSING_ENV:500,INVALID_SERVER_CONFIG:500,FILE_LIMIT_EXCEEDED:500};class rg extends rr{constructor(e){let t="string"==typeof e?{code:"INTERNAL_SERVER_ERROR",message:e}:e;super({message:t.message??function(e,t){return"string"==typeof e?e:e instanceof Error||e&&"object"==typeof e&&"message"in e&&"string"==typeof e.message?e.message:t??"An unknown error occurred"}(t.cause,t.code)}),this._tag="UploadThingError",this.name="UploadThingError",this.code=t.code,this.data=t.data,t.cause instanceof Error?this.cause=t.cause:b(t.cause)&&c(t.cause.status)&&u(t.cause.statusText)?this.cause=Error(`Response ${t.cause.status} ${t.cause.statusText}`):u(t.cause)?this.cause=Error(t.cause):this.cause=t.cause}static toObject(e){return{code:e.code,message:e.message,data:e.data}}static serialize(e){return JSON.stringify(rg.toObject(e))}}class rp extends eG("uploadthing/Fetch")(){}let ry=(e,t)=>tJ(tl(rp),r=>{let n=new Headers(t?.headers??[]),s={url:e.toString(),method:t?.method,body:t?.body,headers:Object.fromEntries(n)};return tD({try:s=>r(e,{...t,headers:n,signal:s}),catch:e=>new ri({error:e instanceof Error?{...e,name:e.name,message:e.message,stack:e.stack}:e,input:s})}).pipe(tX(e=>tN(()=>console.error(e.input))),tF(e=>Object.assign(e,{requestUrl:s.url})),tQ("fetch"))}),rb=e=>tD({try:async()=>({json:await e.json(),ok:e.ok,status:e.status}),catch:t=>new ra({error:t,input:e.requestUrl})}).pipe(tB(({ok:e})=>e,({json:t,status:r})=>new ro({status:r,message:`Request to ${e.requestUrl} failed with status ${r}`,json:t})),tF(({json:e})=>e),tQ("parseJson"));new TextEncoder;let rm=e=>null!=e;var r_="7.2.0";let rS=()=>{let e,t;let r=new AbortController;return{promise:new Promise((r,n)=>{e=r,t=n}),ac:r,resolve:e,reject:t}},rO=e=>{let t=new URL(e.url),r=new URLSearchParams(t.search);return r.set("actionType",e.actionType),r.set("slug",e.slug),t.search=r.toString(),t},rE=e=>(t,r)=>tC(function*(){let n=rO({url:e.url,slug:e.endpoint,actionType:t}),s=new Headers((yield*t$(async()=>"function"==typeof e.headers?await e.headers():e.headers)));return s.set("x-uploadthing-package",e.package),s.set("x-uploadthing-version",r_),s.set("Content-Type","application/json"),yield*ry(n,{method:"POST",body:JSON.stringify(r),headers:s}).pipe(tP(rb),tF(i),tK("FetchError",e=>tT(new rg({code:"INTERNAL_CLIENT_ERROR",message:`Failed to report event "${t}" to UploadThing server`,cause:e}))),tK("BadRequestError",e=>tT(new rg({code:function(e){for(let[t,r]of Object.entries(rd))if(r===e)return t;return"INTERNAL_SERVER_ERROR"}(e.status),message:e.getMessage(),cause:e.json}))),tK("InvalidJson",e=>tT(new rg({code:"INTERNAL_CLIENT_ERROR",message:"Failed to parse response from UploadThing server",cause:e}))))}),rv=(e,t,r,n)=>tA(s=>{let i=new XMLHttpRequest;i.open("PUT",r.url,!0),i.setRequestHeader("Range",`bytes=${t}-`),i.setRequestHeader("x-uploadthing-version",r_),i.responseType="json";let a=0;i.upload.addEventListener("progress",({loaded:e})=>{let t=e-a;n?.({loaded:e,delta:t}),a=e}),i.addEventListener("load",()=>{s(i.status>=200&&i.status<300?tL(i.response):tI(`XHR failed ${i.status} ${i.statusText} - ${JSON.stringify(i.response)}`))}),i.addEventListener("error",()=>{s(new rg({code:"UPLOAD_FAILED"}))});let o=new FormData;return o.append("file",e.slice(t)),i.send(o),tN(()=>i.abort())}),rw=(e,t,r)=>ry(t.url,{method:"HEAD"}).pipe(tF(({headers:e})=>parseInt(e.get("x-ut-range-start")??"0",10)),tz(e=>r.onUploadProgress?.({delta:e,loaded:e})),tJ(n=>rv(e,n,t,e=>r.onUploadProgress?.({delta:e.delta,loaded:e.loaded+n}))),tF(i),tF(r=>({name:e.name,size:e.size,key:t.key,lastModified:e.lastModified,serverData:r.serverData,url:r.url,appUrl:r.appUrl,customId:t.customId,type:e.type,fileHash:r.fileHash}))),rk=(e,t)=>{let r=rE({endpoint:String(e),package:t.package,url:t.url,headers:t.headers}),n=t.files.reduce((e,t)=>e+t.size,0),s=0;return r("upload",{input:"input"in t?t.input:null,files:t.files.map(e=>({name:e.name,size:e.size,type:e.type,lastModified:e.lastModified}))}).pipe(tJ(e=>t3(e,(e,r)=>tJ(tN(()=>t.onUploadBegin?.({file:t.files[r].name})),()=>rw(t.files[r],e,{onUploadProgress:e=>{s+=e.delta,t.onUploadProgress?.({file:t.files[r],progress:Math.round(e.loaded/t.files[r].size*100),loaded:e.loaded,delta:e.delta,totalLoaded:s,totalProgress:Math.round(s/n*100)})}})),{concurrency:6})),tc(rp,window.fetch))},{uploadFiles:rR}=(e=>{let t=new Proxy(rh,{get:(e,t)=>t}),r=async(r,n)=>{let s=new Map,i=rE({endpoint:String("function"==typeof r?r(t):r),package:e.package,url:rf(e?.url),headers:n.headers}),a=await t7(i("upload",{input:"input"in n?n.input:null,files:n.files.map(e=>({name:e.name,size:e.size,type:e.type,lastModified:e.lastModified}))}).pipe(tc(rp,window.fetch))),o=n.files.reduce((e,t)=>e+t.size,0),l=0,u=(e,t)=>rw(e,t,{onUploadProgress:t=>{l+=t.delta,n.onUploadProgress?.({...t,file:e,progress:Math.round(t.loaded/e.size*100),totalLoaded:l,totalProgress:Math.round(l/o*100)})}}).pipe(tc(rp,window.fetch));for(let[e,t]of a.entries()){let r=n.files[e],i=rS();s.set(r,{deferred:i,presigned:t}),t6(u(r,t),{signal:i.ac.signal}).then(e=>{if("Right"===e._tag)return i.resolve(e.right);if("Interrupt"===e.left._tag)throw new rl;throw e7(e.left)}).catch(e=>{!(e instanceof rl)&&i.reject(e)})}return{pauseUpload:e=>{for(let t of eL(e??n.files)){let e=s.get(t);if(!e)return;if(e.deferred.ac.signal.aborted)throw new ru;e.deferred.ac.abort()}},resumeUpload:e=>{for(let t of eL(e??n.files)){let e=s.get(t);if(!e)throw"No upload found";e.deferred.ac=new AbortController,t6(u(t,e.presigned),{signal:e.deferred.ac.signal}).then(t=>{if("Right"===t._tag)return e.deferred.resolve(t.right);if("Interrupt"===t.left._tag)throw new rl;throw e7(t.left)}).catch(t=>{!(t instanceof rl)&&e.deferred.reject(t)})}},done:async e=>{let t=[];for(let r of eL(e??n.files)){let e=s.get(r);if(!e)throw"No upload found";t.push(e.deferred.promise)}let r=await Promise.all(t);return e?r[0]:r}}};return{uploadFiles:(r,n)=>rk("function"==typeof r?r(t):r,{...n,skipPolling:{},url:rf(e?.url),package:e.package,input:n.input}).pipe(e=>t6(e,n.signal&&{signal:n.signal})).then(e=>{if("Right"===e._tag)return e.right;if("Interrupt"===e.left._tag)throw new ru;throw e7(e.left)}),createUpload:r,routeRegistry:t}})({url:"http://localhost:8081/api/uploadthing"}),rj=(e,t=document)=>t.querySelector(e);rj("#file-upload").addEventListener("submit",async e=>{e.preventDefault();let t=rj("#files");console.log("Sending %d files...",t.files.length);let r=await rR("imageUploader",{files:Array.from(t.files)});console.log("Sent."),console.dir(r)})})();
//# sourceMappingURL=main.bundle.js.map